<h3>Общий формат файла</h3>
<p>Файл полигональной геометрии имеет двоичный формат, состоит из заголовка, и пула данных. Заголовок содержит сигнатуру, код номера версии и заголовочные описания блоков (chunks) данных. Каждый блок (chunk) имеет свой уникальный идентификатор, идентификатор поверхности, идентификатор последовательности, тип, число компонент в элементе данных, формат компонент элементов, и число элементов данных. Пул данных сореджит блоки данных с их уникальными идентификаторами, которые устанавливают соответствие между блоками данных и заголовками блоков. Пул данных отделен от заголовка сепаратором.
<p>Общий формат файла полигональной геометрии представлен в таблице 1.

<center><table class=scheme>
  <caption>Таблица 1. Общий формат файла полигональной геометрии</caption>
  <thead><tr><th>Элемент             <td>Сигнатура<td>Код версии<td>Заголовки блоков<td> Сепаратор  <td>Данные блоков</tr>
  <tbody><tr><th>Размер (в байтах)   <td>    8    <td>     4    <td>    chunks*16   <td>      1     <td>   chunks*(4+chunk_data_length) </tr>
  <tr><th>Смещение (от начала)<td>    8    <td>    12    <td>   12+chunks*16 <td>13+chunks*16<td>13+chunks*(20+chunk_data_length)</tr>
</table></center>

<h3>Формат сигнатуры<h3>
<p>Сигнатура служит для идентификации типа файла загрузчиком и содержит уникальный код.
<p class=code>#!UNMESH
<p>В процессе загрузки первой проверяется сигнатура файла, если она полностью соответсвует затребованной, то процесс продолжается, иначе процесс загрузки считается невозможным и останавливается.
<h3>Соглашение о нумерации версий</h3>
<p>Соглашение о нумерации версий определяет условия соответствии формата файла и средств, обеспечивающих работу с ним. Сразу же после проверки сигнатуры загрузчик проверяет версию файла в соответствии с этим соглашением.
<p>Соглашение включает следующие условия:
<ul>
  <li>Первые номера версий файла и загрузчика должны совпадать
  <li>Второй номер версии файла может быть не более чем на 2 меньше номера версии загрузчика, но не болше него
  <li>Третий номер версии файла должен быть не больше третьего номера версии загрузчика
  <li>Червертый номер файла версии должен быть не больше четвертого номера версии загрузчика, но той же четности
</ul>
<p>Формат хранения версии представлен в таблице 2.

<center><table class=scheme>
  <caption>Таблица 2. Формат хранения версии файла</caption>
  <thead><tr><th>Номер версии         <td>Первый<td>Второй<td>Третий<td>Четвертый</tr>
  <tbody><tr><th>Размер (в байтах)    <td>   1  <td>   1  <td>   1  <td>    1    </tr>
  <tr><th>Смещение (от начала сегмент)<td>   1  <td>   2  <td>   3  <td>    4    </tr>
</table></center>

<h3>Заголовок блока данных</h3>
<p>Заголовок блока данных полностью и однозначно определяет данные, ассоциированные с этим блоком. Заголовок содержит атрибуты, описание которых представлено в таблице 3.

<center><table class=scheme>
  <caption>Таблица 3. Атрибуты заголовка блока данных</caption>
  <thead><tr><td>Имя атрибута<td>Назначение атрибута              <td>Предполагаемый тип атрибута</tr>
  <tbody><tr><td>     id     <td>Идентификатор блока              <td>unsigned int               </tr>
  <tr><td>           surf    <td>Идентификатор поверхности        <td>unsigned int               </tr>
  <tr><td>           type    <td>Тип данных блока                 <td>unsigned char              </tr>
  <tr><td>           seq     <td>Номер в последовательности       <td>unsigned char              </tr>
  <tr><td>          format   <td>Формат компоненты данных         <td>unsigned char              </tr>
  <tr><td>          compon   <td>Число компонент в элементе данных<td>unsigned char              </tr>
  <tr><td>           size    <td>Число элементов в массиве данных <td>unsigned int               </tr>
</table></center>

<p>В таблице 4 приведен формат хранения заголовка блока в файле. Все заголовки имеют фиксированный размер и хранятся в файле последовательно, для обеспечения простоты их считывания.

<center><table class=scheme>
  <caption>Таблица 4. Формат хранения заголовка блока в файле</caption>
  <thead><tr><th>Элемент             <td>id<td>surf<td>type<td>seq<td>format<td>compon<td>size</tr>
  <tbody><tr><th>Размер (в байтах)   <td>4 <td> 4  <td> 1  <td> 1 <td>   1  <td>   1  <td>  4 </tr>
  <tr><th>Смещение (от начала блока) <td>4 <td> 8  <td> 9  <td>10 <td>  11  <td>  12  <td> 16 </tr>
</table></center>

<p>Сразу же после определения соответствия версий загрузчик должен последовательно считать заголовки блоков, пока не будет обнаружен сепаратор, представляющий собой 4 байта с нулевым значением (нулевой идентификатор).

<h3>Формат блока данных</h3>

<p>блок данных состоит из двух частей: идентификатора и данных. Идентификатор устанавливает соответствие данных блока набору атрибутов заголовка. Формат хранения блока данных приведен в таблице 5.

<center><table class=scheme>
  <caption>Таблица 5. Формат хранения блока данных в файле</caption>
  <thead><tr><th>Элемент             <td>id<td>data                </tr>
  <tbody><tr><th>Размер (в байтах)   <td>4 <td>format*compon*size  </tr>
  <tr><th>Смещение (от начала блока) <td>4 <td>4+format*compon*size</tr>
</table></center>

<p>Когда загрузчик наталкивается на нулевой идентификатор, начинается вторая фаза загрузки - считывание данных. Загрузчик считывает идентификатор, устанавливает его соответствие уже загруженному набору атрибутов. Эти атрибуты будут использоваться для определения длины данных, которые требуется считать (см. таблицу 5). Данные блоков подобно заголовкам хранятся последовательно друг за другом.

<h3>Описание атрибута типа данных</h3>

<p>Значение типа данных (атрибут type) определяет то, что представляет собой их содержимое. Обычно тип не предполагает никаких определенных действий, применяемых к данным со стороны загрузчика. Этот атрибут служит для дальнейших определения действий над данными, применяемых при воссоздании геометрии. В таблице 6 приведены использующиеся в настоящий момент типы данных и краткие комментарии к ним.

<center><table class=scheme>
  <caption>Таблица 6. Используемые типы данных</caption>
  <thead><tr><td>Имя типа<td>Код типа<td>Назначение типа     </tr>
  <tbody><tr><td> vertex <td>   0x0  <td>Вершинные координаты</tr>
  <tr><td>        normal <td>   0x1  <td>Нормали к вершинам</tr>
  <tr><td>       binormal<td>   0x2  <td>Бинормали</tr>
  <tr><td>       tangent <td>   0x3  <td>Тангентны</tr>
  <tr><td>       texcoord<td>   0x4  <td>Текстурные координаты</tr>
  <tr><td>       element <td>   0x5  <td>Элементы (вершинные индексы треугольников)</tr>
  <tr><td>       material<td>   0x6  <td>Индексы материалов</tr>
  <tr><td>         bone  <td>   0x7  <td>Индексы костей (привязки вершин к костям)</tr>
  <tr><td>        weight <td>   0x8  <td>Веса вершин</tr>
</table></center>

<p>Перечень типов может быть дополнен в будущем.

